---
phase: 08-meeting-realtime-completion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - meeting-bot-webapp/vercel.json
  - meeting-bot-webapp/src/index.html
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Output Media webapp has a vercel.json deployment configuration"
    - "Webapp source files are servable as a static site"
    - "index.html correctly references the bundled app.js or raw app.js"
    - "Deployed webapp loads at MEETING_BOT_WEBAPP_URL without 404 (verified by human checkpoint)"
  artifacts:
    - path: "meeting-bot-webapp/vercel.json"
      provides: "Vercel static site deployment configuration"
      contains: "outputDirectory"
    - path: "meeting-bot-webapp/src/index.html"
      provides: "HTML entry point for Output Media webapp"
      contains: "app.js"
  key_links:
    - from: "meeting-bot-webapp/vercel.json"
      to: "meeting-bot-webapp/src/"
      via: "Vercel serves src/ directory as static site"
      pattern: "outputDirectory"
    - from: "src/app/config.py"
      to: "meeting-bot-webapp deployment"
      via: "MEETING_BOT_WEBAPP_URL env var points to deployed URL"
      pattern: "MEETING_BOT_WEBAPP_URL"
---

<objective>
Add deployment configuration for the Output Media webapp so it can be deployed to Vercel as a static site, and verify the webapp is deployment-ready.

Purpose: Close Gap 2 from the v1 milestone audit -- BotManager._build_output_media_url() references MEETING_BOT_WEBAPP_URL but the webapp has no deployment config and isn't hosted anywhere. Without a deployed webapp, Recall.ai's headless browser loads a 404 and the avatar won't render.

Output: vercel.json config, deployment-ready webapp, checkpoint for user to deploy and configure env var.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@meeting-bot-webapp/package.json
@meeting-bot-webapp/src/index.html
@meeting-bot-webapp/src/app.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vercel deployment config and verify webapp is deployment-ready</name>
  <files>
    meeting-bot-webapp/vercel.json
    meeting-bot-webapp/src/index.html
  </files>
  <action>
**Step 1: Create meeting-bot-webapp/vercel.json**

The webapp uses esbuild to bundle src/app.js into dist/app.js. However, for Vercel deployment, we have two options:
- Option A: Build step (npm run build -> serve dist/) -- requires esbuild as build dependency
- Option B: Serve src/ directly as static files -- simpler, no build step needed since app.js is vanilla JS with only livekit-client as an import

Since the app uses `import` from livekit-client, it NEEDS the esbuild bundle step. Use Option A with Vercel build:

```json
{
  "version": 2,
  "name": "agent-army-meeting-bot",
  "buildCommand": "npm install && npm run build",
  "outputDirectory": "dist",
  "installCommand": "npm install",
  "framework": null,
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}
```

Wait -- the build outputs to dist/app.js but index.html is in src/. We need index.html in dist/ too. Check the current build script: `esbuild src/app.js --bundle --outfile=dist/app.js --format=esm --platform=browser --target=es2020`

This only outputs app.js to dist/. We need to also copy index.html to dist/. Update approach:

Create vercel.json that:
1. Runs npm install + npm run build
2. Copies index.html to dist/
3. Serves from dist/

```json
{
  "version": 2,
  "name": "agent-army-meeting-bot",
  "buildCommand": "npm install && npm run build && cp src/index.html dist/index.html",
  "outputDirectory": "dist",
  "framework": null
}
```

**Step 2: Verify index.html references correct script path**

Read meeting-bot-webapp/src/index.html and check the script tag. It should reference app.js (not src/app.js) since after build, both index.html and app.js will be in dist/.

If index.html references `src/app.js` or `./app.js`, adjust as needed. The script tag should be:
```html
<script type="module" src="./app.js"></script>
```

If it currently references a different path, update it to `./app.js` since in the dist/ directory, index.html and app.js will be siblings.

**Step 3: Add avatar/ and pipeline/ subdirectories to build if referenced**

Check if app.js imports from relative paths like `./avatar/...` or `./pipeline/...`. Since esbuild bundles everything, these will be inlined into dist/app.js. No additional file copying needed for JS files.

Check if there are any non-JS assets (CSS, images) in the src/ directory that need copying. If so, add them to the cp command in buildCommand.

**Step 4: Verify build works locally**

Run: `cd meeting-bot-webapp && npm install && npm run build`

Confirm dist/app.js is generated without errors.

**Step 5: Add any static assets that need copying**

If there are CSS files, fonts, or images in src/ that index.html references, add them to the buildCommand cp chain. Check index.html for any link/img tags referencing local files.
  </action>
  <verify>
    test -f meeting-bot-webapp/vercel.json && echo "vercel.json exists"
    cd meeting-bot-webapp && npm install && npm run build && echo "Build successful"
    test -f meeting-bot-webapp/dist/app.js && echo "dist/app.js exists"
    grep "app.js" meeting-bot-webapp/src/index.html
  </verify>
  <done>
    vercel.json exists with correct buildCommand, outputDirectory, and framework settings. npm run build succeeds and produces dist/app.js. index.html references ./app.js correctly for the dist/ layout.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Deployment configuration for the Output Media webapp (meeting-bot-webapp/vercel.json). The webapp is bundled and ready for deployment.
  </what-built>
  <how-to-verify>
    1. Deploy the webapp to Vercel:
       ```bash
       cd meeting-bot-webapp
       npx vercel --prod
       ```
       (Or use `vercel` CLI if installed globally. Follow prompts to link to your Vercel account.)

    2. Note the deployment URL (e.g., https://agent-army-meeting-bot.vercel.app)

    3. Set the environment variable:
       - Add `MEETING_BOT_WEBAPP_URL=https://your-deployed-url.vercel.app` to your .env file
       - For production: add to your deployment secrets/environment

    4. Open the deployed URL in a browser to verify it loads without 404
       (The page will show the avatar UI shell -- it won't be functional without a meeting WebSocket connection, but it should load without errors)

    5. Optional: If you prefer Netlify or another static host instead of Vercel, the webapp is a standard static site -- deploy dist/ after running `npm run build` and copy src/index.html to dist/.
  </how-to-verify>
  <resume-signal>Type "deployed" with the URL, or "skip" to continue without deployment (real-time avatar won't work but other gaps will still be closed)</resume-signal>
</task>

</tasks>

<verification>
1. `test -f meeting-bot-webapp/vercel.json` -- Deployment config exists
2. `cd meeting-bot-webapp && npm run build` -- Build succeeds
3. `test -f meeting-bot-webapp/dist/app.js` -- Bundle output exists
4. `grep "outputDirectory" meeting-bot-webapp/vercel.json` -- Correct output directory configured
</verification>

<success_criteria>
- meeting-bot-webapp/vercel.json exists with correct Vercel static site configuration
- npm run build succeeds and produces dist/app.js
- index.html correctly references app.js for the dist/ layout
- User has been prompted to deploy and configure MEETING_BOT_WEBAPP_URL
</success_criteria>

<output>
After completion, create `.planning/phases/08-meeting-realtime-completion/08-02-SUMMARY.md`
</output>
