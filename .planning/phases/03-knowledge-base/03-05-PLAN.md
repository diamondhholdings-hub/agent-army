---
phase: 03-knowledge-base
plan: 05
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/knowledge/methodology/__init__.py
  - src/knowledge/methodology/frameworks.py
  - src/knowledge/methodology/loader.py
  - src/knowledge/regional/__init__.py
  - src/knowledge/regional/nuances.py
  - data/methodology/meddic.md
  - data/methodology/bant.md
  - data/methodology/spin.md
  - data/regional/apac.md
  - data/regional/emea.md
  - data/regional/americas.md
  - tests/knowledge/test_methodology.py
  - tests/knowledge/test_regional.py
autonomous: true

must_haves:
  truths:
    - "Sales methodology frameworks (MEDDIC, BANT) are structured as both Pydantic models and searchable text"
    - "Methodology queries return relevant framework steps with rich examples"
    - "Regional nuances (APAC, EMEA, Americas) are queryable and affect content retrieval"
    - "Methodologies are universal across all tenants (not per-tenant customized)"
  artifacts:
    - path: "src/knowledge/methodology/frameworks.py"
      provides: "Pydantic models for MEDDIC, BANT, SPIN frameworks with structured steps and examples"
      exports: ["MEDDICFramework", "BANTFramework", "MethodologyLibrary"]
    - path: "src/knowledge/methodology/loader.py"
      provides: "Loads methodology content into Qdrant as searchable chunks"
      exports: ["MethodologyLoader"]
    - path: "src/knowledge/regional/nuances.py"
      provides: "Region-specific content and customization rules"
      exports: ["RegionalNuances", "get_regional_context"]
    - path: "data/methodology/meddic.md"
      provides: "MEDDIC framework content with examples"
      min_lines: 80
    - path: "data/methodology/bant.md"
      provides: "BANT framework content with examples"
      min_lines: 60
  key_links:
    - from: "src/knowledge/methodology/loader.py"
      to: "src/knowledge/qdrant_client.py"
      via: "stores methodology chunks in Qdrant"
      pattern: "QdrantKnowledgeStore"
    - from: "src/knowledge/methodology/frameworks.py"
      to: "src/knowledge/models.py"
      via: "methodology models reference ChunkMetadata content_type=methodology"
      pattern: "content_type"
    - from: "src/knowledge/regional/nuances.py"
      to: "src/knowledge/models.py"
      via: "regional data tagged with region metadata"
      pattern: "region"
---

<objective>
Build the sales methodology library (MEDDIC, BANT, SPIN) with structured frameworks and rich examples, plus regional customization data (APAC, EMEA, Americas) -- both as queryable knowledge in Qdrant.

Purpose: Sales agents need methodology guidance (e.g., "What MEDDIC questions should I ask in discovery?") and region-aware context (e.g., "How should I approach pricing in APAC?"). This plan provides both structured programmatic access AND semantic search over methodology and regional content.

Output: Structured methodology frameworks + natural language methodology docs ingested into Qdrant. Regional nuance documents tagged and searchable by region.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-knowledge-base/03-01-SUMMARY.md

Depends on Plan 01 for QdrantKnowledgeStore, EmbeddingService, and models.
Does NOT depend on Plan 02 (ingestion pipeline) -- methodology content has its own specialized loader since it needs both structured Pydantic models AND text documents.

Locked decisions:
- Methodology format: Both structured framework AND text documents
- Methodology customization: Universal across all tenants/regions
- Methodology examples: Include rich examples
- Metadata tagging: product_category, buyer_persona, sales_stage, region
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create methodology frameworks and content documents</name>
  <files>
    src/knowledge/methodology/__init__.py
    src/knowledge/methodology/frameworks.py
    data/methodology/meddic.md
    data/methodology/bant.md
    data/methodology/spin.md
  </files>
  <action>
    src/knowledge/methodology/frameworks.py - Pydantic models for structured methodology access:

    MethodologyStep(BaseModel):
    - name: str (e.g., "Metrics", "Economic Buyer")
    - abbreviation: str (e.g., "M", "E")
    - description: str
    - purpose: str (why this step matters)
    - key_questions: list[str] (5-8 questions per step)
    - examples: list[MethodologyExample]
    - sales_stage: str (which stage this step typically applies to)
    - tips: list[str] (practical guidance)

    MethodologyExample(BaseModel):
    - scenario: str (the situation)
    - good_example: str (effective application)
    - bad_example: str (common mistake)
    - explanation: str (why good is better)

    MethodologyFramework(BaseModel):
    - name: str (e.g., "MEDDIC")
    - full_name: str (e.g., "Metrics, Economic Buyer, Decision Criteria, Decision Process, Identify Pain, Champion")
    - description: str
    - when_to_use: str
    - steps: list[MethodologyStep]
    - summary_checklist: list[str]

    MethodologyLibrary class:
    - frameworks: dict[str, MethodologyFramework] (keyed by name)
    - get_framework(name: str) -> MethodologyFramework
    - get_step(framework: str, step: str) -> MethodologyStep
    - get_questions_for_stage(stage: str) -> list[dict]: Returns questions from all frameworks relevant to a sales stage
    - Pre-populate with MEDDIC, BANT, SPIN frameworks using rich, realistic content

    data/methodology/meddic.md (~150 lines):
    - Full MEDDIC methodology in markdown format, optimized for semantic search
    - Each letter/step as a ## section
    - Rich examples, discovery questions, common pitfalls
    - Cross-references to sales stages
    - Practical tips for each step (e.g., "When identifying the Economic Buyer, ask: 'Who signs the purchase order?' not 'Who's your boss?'")

    data/methodology/bant.md (~100 lines):
    - Budget, Authority, Need, Timeline
    - Each as ## section with examples
    - When to use BANT vs MEDDIC (BANT for faster/simpler deals, MEDDIC for complex enterprise)
    - Modern BANT adaptations (e.g., "Budget is less about 'do you have budget' and more about 'is this a funded initiative'")

    data/methodology/spin.md (~100 lines):
    - Situation, Problem, Implication, Need-Payoff
    - Question progression examples
    - When SPIN is most effective (discovery, early engagement)
    - Integration with MEDDIC (SPIN for discovery phase, MEDDIC for qualification)
  </action>
  <verify>
    Run:
    - `python -c "from src.knowledge.methodology.frameworks import MethodologyLibrary; lib = MethodologyLibrary(); print(f'Frameworks: {list(lib.frameworks.keys())}')"` outputs MEDDIC, BANT, SPIN
    - `wc -l data/methodology/*.md` shows substantial content in each file
    - Verify structured access: `python -c "from src.knowledge.methodology.frameworks import MethodologyLibrary; lib = MethodologyLibrary(); step = lib.get_step('MEDDIC', 'Metrics'); print(f'Questions: {len(step.key_questions)}')"` returns 5+
  </verify>
  <done>
    Three methodology frameworks (MEDDIC, BANT, SPIN) exist as both structured Pydantic models (programmatic access) and markdown documents (semantic search). Each framework has steps with questions, examples, and practical tips.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create regional nuances and ingest methodology + regional content into Qdrant</name>
  <files>
    src/knowledge/methodology/loader.py
    src/knowledge/regional/__init__.py
    src/knowledge/regional/nuances.py
    data/regional/apac.md
    data/regional/emea.md
    data/regional/americas.md
    tests/knowledge/test_methodology.py
    tests/knowledge/test_regional.py
  </files>
  <action>
    data/regional/apac.md (~80 lines):
    - Cultural considerations: Relationship-first selling, importance of hierarchy, consensus decision-making
    - Communication style: Indirect, emphasis on harmony, patience in negotiations
    - Pricing: 10% regional discount standard, annual contracts preferred
    - Key markets: Japan (formal, process-heavy), Singapore (direct, English-fluent), Australia (casual, outcome-focused)
    - Compliance: Data residency requirements, PDPA (Singapore), APPI (Japan)
    - Common objections and responses specific to APAC

    data/regional/emea.md (~80 lines):
    - Cultural considerations: Varies widely. DACH (process-oriented, thorough), UK (pragmatic), France (relationship-heavy), Nordics (egalitarian)
    - GDPR compliance requirements and implications for positioning
    - Pricing: EUR standard, GBP for UK, VAT handling
    - Decision cycles: Generally longer than Americas, more stakeholders
    - Compliance: GDPR, NIS2, local data sovereignty

    data/regional/americas.md (~80 lines):
    - US: Direct, ROI-focused, faster decision cycles, pilot-first approach
    - Canada: Similar to US but more conservative, bilingual considerations (Quebec)
    - LATAM: Relationship-important, Spanish/Portuguese, longer payment terms
    - Pricing: USD standard, potential for multi-year discounts
    - Compliance: SOC 2, FedRAMP (government), CCPA (California)

    src/knowledge/regional/nuances.py - RegionalNuances class:
    - regions: dict mapping region codes to regional config
    - get_regional_context(region: str) -> dict: Returns cultural, pricing, compliance context for a region
    - get_pricing_modifier(region: str) -> float: Returns pricing multiplier (e.g., 0.9 for APAC)
    - get_compliance_requirements(region: str) -> list[str]: Returns relevant compliance frameworks
    - Load from data/regional/ markdown files

    src/knowledge/methodology/loader.py - MethodologyLoader class:
    - __init__(store: QdrantKnowledgeStore, embedder: EmbeddingService)
    - async load_methodologies(tenant_id: str) -> int:
      * Load all methodology markdown files from data/methodology/
      * Chunk each methodology into step-level chunks (one chunk per step/letter)
      * Tag with content_type="methodology", sales_stage per step
      * Embed and store in Qdrant knowledge_base collection
      * Return number of chunks created
    - async load_regional_data(tenant_id: str) -> int:
      * Load all regional markdown files from data/regional/
      * Chunk into topic-level chunks (cultural, pricing, compliance per region)
      * Tag with content_type="regional", region per document
      * Embed and store in Qdrant
      * Return number of chunks created

    tests/knowledge/test_methodology.py:
    - Mock EmbeddingService for deterministic vectors
    - test_methodology_library_structured_access: Verify get_framework, get_step, get_questions_for_stage work correctly
    - test_methodology_ingestion: Load methodology docs into Qdrant (local, tmp_path), verify chunks created with correct content_type="methodology"
    - test_methodology_search: After ingestion, search "how to identify economic buyer" and verify MEDDIC Economic Buyer chunk returned
    - test_methodology_stage_filtering: Search with sales_stage="discovery" filter, verify relevant methodology steps returned

    tests/knowledge/test_regional.py:
    - test_regional_nuances_access: Verify get_regional_context returns data for APAC, EMEA, Americas
    - test_regional_ingestion: Load regional docs into Qdrant, verify chunks created with correct region tags
    - test_regional_search: Search "GDPR compliance" with region="emea" filter, verify EMEA compliance content returned
    - test_regional_pricing_modifier: Verify APAC returns 0.9, others return 1.0
  </action>
  <verify>
    Run:
    - `pytest tests/knowledge/test_methodology.py tests/knowledge/test_regional.py -v`
    All tests pass. Verify:
    - Methodology search returns framework-relevant chunks
    - Regional search respects region filters
    - Structured access (MethodologyLibrary, RegionalNuances) works independently of Qdrant
  </verify>
  <done>
    Sales methodology content (MEDDIC, BANT, SPIN) is both structurally accessible via Pydantic models AND semantically searchable in Qdrant. Regional nuance data for APAC, EMEA, Americas is tagged and searchable with region filters. Methodology is universal (not tenant-specific). All content ingested and retrievable.
  </done>
</task>

</tasks>

<verification>
- `pytest tests/knowledge/test_methodology.py tests/knowledge/test_regional.py -v` all pass
- MethodologyLibrary provides structured access to MEDDIC, BANT, SPIN
- RegionalNuances provides region-specific context
- Methodology queries in Qdrant return relevant step-level chunks
- Regional queries with region filter return correct region's content
- Content files exist: data/methodology/*.md, data/regional/*.md
</verification>

<success_criteria>
- MEDDIC, BANT, SPIN frameworks are structured Pydantic models with steps, questions, examples
- Methodology markdown documents are ingested into Qdrant with content_type="methodology"
- Regional data for APAC, EMEA, Americas is ingested with region metadata tags
- Methodology queries return relevant framework content
- Regional queries respect region filters
- Methodologies are universal (same content regardless of tenant)
- Structured programmatic access works independently of vector search
</success_criteria>

<output>
After completion, create `.planning/phases/03-knowledge-base/03-05-SUMMARY.md`
</output>
