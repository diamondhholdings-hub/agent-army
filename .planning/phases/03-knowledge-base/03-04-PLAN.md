---
phase: 03-knowledge-base
plan: 04
type: execute
wave: 4
depends_on: ["03-03"]
files_modified:
  - data/products/monetization-platform.md
  - data/products/charging.md
  - data/products/billing.md
  - data/products/pricing/esw-pricing.json
  - data/products/positioning/battlecard-vs-competitor-a.md
  - data/products/positioning/use-case-digital-transformation.md
  - tests/knowledge/test_product_ingestion.py
autonomous: true

must_haves:
  truths:
    - "ESW product knowledge (Monetization Platform, Charging, Billing -- features, pricing, positioning) is ingested and stored in Qdrant"
    - "Product queries return relevant feature-level chunks with correct metadata (product_category: monetization, charging, or billing)"
    - "Pricing queries return structured pricing data for correct product tiers"
    - "Competitive positioning queries return relevant battlecard content"
  artifacts:
    - path: "data/products/monetization-platform.md"
      provides: "ESW Monetization Platform product knowledge document"
      min_lines: 100
    - path: "data/products/charging.md"
      provides: "ESW Charging product knowledge document"
      min_lines: 80
    - path: "data/products/billing.md"
      provides: "ESW Billing product knowledge document"
      min_lines: 80
    - path: "data/products/pricing/esw-pricing.json"
      provides: "Structured pricing data for all ESW products (Monetization Platform, Charging, Billing)"
      contains: "Enterprise"
  key_links:
    - from: "tests/knowledge/test_product_ingestion.py"
      to: "src/knowledge/ingestion/pipeline.py"
      via: "uses IngestionPipeline to ingest product data"
      pattern: "IngestionPipeline"
    - from: "tests/knowledge/test_product_ingestion.py"
      to: "src/knowledge/qdrant_client.py"
      via: "verifies retrieval from Qdrant after ingestion"
      pattern: "QdrantKnowledgeStore|hybrid_search"
---

<objective>
Create the ESW product knowledge base content (Monetization Platform, Charging, Billing) and verify end-to-end ingestion and retrieval of product features, pricing, and positioning data through the IngestionPipeline.

Purpose: This is the first real content entering the knowledge base. It proves the pipeline works with realistic product documents and establishes the product knowledge that sales agents will query. The data files also serve as templates for ingesting new products when ESW acquires businesses.

Output: Six ESW product knowledge documents ingested and retrievable via Qdrant. Verified retrieval of product features, pricing, and competitive positioning.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-knowledge-base/03-03-SUMMARY.md

Depends on Plan 03 for IngestionPipeline class.
Also transitively depends on Plan 01 (Qdrant, embeddings, models) and Plan 02 (loaders, chunker, metadata extractor).

Locked decisions:
- Per-product organization (each ESW product is a separate knowledge unit: Monetization Platform, Charging, Billing)
- Product categories: Monetization, Charging, Billing (NOT fictional names)
- Feature-level chunks
- Pricing: Both structured data AND natural language docs
- Positioning: Both per-competitor battlecards AND per-use-case value props
- Versioning: Track knowledge versions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ESW product knowledge documents</name>
  <files>
    data/products/monetization-platform.md
    data/products/charging.md
    data/products/billing.md
    data/products/pricing/esw-pricing.json
    data/products/positioning/battlecard-vs-competitor-a.md
    data/products/positioning/use-case-digital-transformation.md
  </files>
  <action>
    Create realistic ESW product documents. ESW provides telecom/digital services monetization solutions. Create three products matching the actual ESW portfolio:

    data/products/monetization-platform.md (~300 lines):
    - YAML frontmatter: product_category: "monetization", buyer_persona: ["technical", "business", "executive"], sales_stage: ["discovery", "evaluation"], region: ["global"]
    - Overview section: What the ESW Monetization Platform is -- a comprehensive platform for digital services monetization, enabling operators and enterprises to launch, manage, and optimize revenue from digital services (subscriptions, usage-based, prepaid, hybrid models)
    - Features (each as ## header, self-contained):
      * Subscription Management: Plan creation, lifecycle management, upgrades/downgrades, trial-to-paid conversion
      * Usage-Based Pricing: Real-time usage metering, rating engine, flexible pricing models (per-unit, tiered, volume)
      * Prepaid & Balance Management: Prepaid credits, wallet top-ups, balance thresholds, auto-replenishment
      * Revenue Optimization: Smart bundling, cross-sell/upsell recommendations, churn prediction signals
      * Partner & Channel Management: Revenue sharing, partner settlements, multi-channel distribution
    - Each feature: description, key capabilities (bullet points), ideal buyer persona, typical use case
    - Cross-references to Charging and Billing products where relevant

    data/products/charging.md (~200 lines):
    - YAML frontmatter: product_category: "charging", buyer_persona: ["technical", "operations"], sales_stage: ["discovery", "evaluation", "demo"], region: ["global"]
    - Overview: ESW Charging -- real-time convergent charging system for telecom and digital services. Handles online/offline charging, rating, balance management, and policy control.
    - Features: Real-Time Rating Engine, Convergent Charging (prepaid + postpaid), Policy & Quota Management, Multi-Service Support (voice, data, content, IoT), Mediation & Event Processing
    - Cross-references to Monetization Platform and Billing

    data/products/billing.md (~200 lines):
    - YAML frontmatter: product_category: "billing", buyer_persona: ["business", "operations"], sales_stage: ["discovery", "evaluation", "negotiation"], region: ["global"]
    - Overview: ESW Billing -- automated invoicing, payment processing, revenue recognition, and financial reporting for telecom and enterprise customers.
    - Features: Automated Invoice Generation, Multi-Currency & Tax Management, Payment Gateway Integration, Revenue Recognition & Reporting, Dunning & Collections Management
    - Cross-references to Monetization Platform and Charging

    data/products/pricing/esw-pricing.json:
    - Structured JSON with all three ESW products (Monetization Platform, Charging, Billing)
    - Each product has tiers: Starter, Professional, Enterprise
    - Each tier: monthly_price, annual_price (discount), included_features (list), limits (transactions, API calls, accounts), support_level
    - Regional pricing variations: APAC (10% discount), EMEA (standard), Americas (standard)
    - Add-ons: premium support, dedicated infrastructure, custom SLAs

    data/products/positioning/battlecard-vs-competitor-a.md:
    - Competitive battlecard format for ESW vs a generic competitor
    - Our strengths vs their weaknesses (table format)
    - Common objections and responses
    - Win/loss analysis talking points
    - Differentiation on: monetization flexibility, charging performance, billing accuracy, support, compliance

    data/products/positioning/use-case-digital-transformation.md:
    - Use case narrative: Telecom operator modernizing from legacy BSS to cloud-native monetization
    - Problem statement, solution approach, expected outcomes
    - Which ESW products apply (Monetization Platform, Charging, Billing) and how they work together
    - Customer success metrics / ROI framework
    - Discovery questions for this use case
  </action>
  <verify>
    Verify all files exist and have substantive content:
    - `wc -l data/products/*.md` shows each file has 100+ lines
    - `python -c "import json; json.load(open('data/products/pricing/esw-pricing.json'))"` validates JSON
    - `head -5 data/products/monetization-platform.md` shows YAML frontmatter with product_category: "monetization"
  </verify>
  <done>
    Six product knowledge documents exist covering three ESW products (Monetization Platform, Charging, Billing), structured pricing, competitive battlecard, and use-case positioning. Product categories use correct values: monetization, charging, billing. Content is realistic and rich enough for meaningful semantic search.
  </done>
</task>

<task type="auto">
  <name>Task 2: Ingest product data and verify retrieval</name>
  <files>
    tests/knowledge/test_product_ingestion.py
  </files>
  <action>
    tests/knowledge/test_product_ingestion.py:
    - Uses a mock EmbeddingService that returns deterministic vectors (to avoid OpenAI API calls in tests)
    - test_ingest_monetization_platform: Ingest monetization-platform.md via IngestionPipeline, verify chunks stored in Qdrant with product_category="monetization" (use local Qdrant with tmp_path)
    - test_ingest_all_products: Ingest all 6 product docs via ingest_all_esw_products helper, verify total chunk count
    - test_retrieve_product_features: After ingestion, search "subscription management" and verify relevant chunk returned with correct metadata (product_category: "monetization")
    - test_retrieve_pricing: After ingestion, search "enterprise pricing" and verify pricing chunk returned
    - test_retrieve_positioning: Search "competitor comparison" and verify battlecard content returned
    - test_cross_product_references: Verify chunks that mention other ESW products have cross_references populated
    - test_tenant_scoped_product_retrieval: Ingest for tenant A, verify tenant B cannot retrieve product data
  </action>
  <verify>
    Run: `pytest tests/knowledge/test_product_ingestion.py -v`
    All tests pass. Specifically:
    - All product documents ingest without errors
    - Product feature queries return relevant chunks with correct product_category
    - Pricing queries return structured pricing data
    - Competitive positioning queries return battlecard content
    - Tenant isolation maintained
  </verify>
  <done>
    ESW product data (Monetization Platform, Charging, Billing) ingested and retrievable via Qdrant. Product categories correctly tagged. Cross-references between products populated. Retrieval verified for feature, pricing, and positioning queries.
  </done>
</task>

</tasks>

<verification>
- `pytest tests/knowledge/test_product_ingestion.py -v` all pass
- All 6 product data files exist with substantive content
- Product retrieval returns relevant chunks for feature, pricing, and positioning queries
- Product categories in stored chunks match: monetization, charging, billing
- Cross-references between ESW products are populated
</verification>

<success_criteria>
- ESW product knowledge (Monetization Platform, Charging, Billing + pricing + 2 positioning docs) is ingested into Qdrant
- Feature-level queries return relevant product chunks with correct product_category metadata (monetization, charging, billing)
- Pricing queries return structured pricing information
- Positioning queries return competitive and use-case content
- All operations are tenant-scoped
</success_criteria>

<output>
After completion, create `.planning/phases/03-knowledge-base/03-04-SUMMARY.md`
</output>
